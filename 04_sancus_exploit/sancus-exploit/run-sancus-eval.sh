#!/bin/bash

set -x

# install
cd ../sancus-core
mkdir -p build && cd build/ && cmake ..

# run control experiment: expected output, memory violation
cd ..
./core/sim/rtl_sim/run/run ../../../../../sancus-exploit/call_exploit

# apply vulnerable patch
git apply ../sancus-exploit/make-vulnerable.patch

# run second experiment: expected output, attacker changed value
./core/sim/rtl_sim/run/run ../../../../../sancus-exploit/call_exploit

# restore original state
git checkout .
